<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Access Log Viewer</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    button { font-size: 24px; padding: 20px; margin-bottom: 20px; width: 100%; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background: #eee; }
    td { font-size: 14px; }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

</head>
<body>
<button onclick="loadLog()">Refreash</button>
  <table id="logTable">
    <thead>
      <tr id="tableHeader"></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
   // const API_URL = "https://localhost:7089/api/log";
      const API_URL = "https://captchasysbacksmart.onrender.com/api/log";

    async function loadLog() {
      const res = await fetch(API_URL);
      const lines = await res.json();

      const tbody = document.querySelector('#logTable tbody');
      const headerRow = document.querySelector('#tableHeader');

      tbody.innerHTML = '';
      headerRow.innerHTML = '';

      if (lines.length === 0) return;

      const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
      headers.push("Action");
      headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });

      const statusIndex = headers.indexOf("status");

      for (let i = 1; i < lines.length; i++) {
        const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(val =>
          val.replace(/^"|"$/g, '').replace(/""/g, '"')
        );

        while (row.length < headers.length - 1) row.push("");

        const tr = document.createElement('tr');

        const status = row[statusIndex];
        if (status === "accepted") tr.style.backgroundColor = "#d4f7d4";
        if (status === "banned") tr.style.backgroundColor = "#f9d6d5";

        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });

        const actionCell = document.createElement('td');
        const delButton = document.createElement('button');
       delButton.innerHTML = '<i class="fas fa-trash"></i>';

    
        delButton.onclick = async () => {
          await fetch(`${API_URL}/${i}`, { method: 'DELETE' });
          loadLog();
        };
        actionCell.appendChild(delButton);
        tr.appendChild(actionCell);

        tbody.appendChild(tr);
      }
    }

    window.onload = loadLog;
  </script>
</body>
</html>
